import{x as k,C as V,u as F,r as l,o as L,a as d,s as u,b as s,q as S,i as b,v as _,j as q,F as B,l as M,t as C,f as w,h as N}from"./index-BahtY7yE.js";import{u as D}from"./Post-Baz_lnpz.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={setup(){const m=k(),e=V(),r=F(),t=D(),v=Number(e.params.id),c=l(""),n=l(""),o=l(""),g=l(""),y=l(""),p=l(!1),f=l(null),P=[{value:"technology",label:"Công nghệ"},{value:"lifestyle",label:"Lối sống"},{value:"travel",label:"Du lịch"},{value:"food",label:"Ẩm thực"}];return L(()=>{var i;if(!r.isAuthenticated){m.push("/login");return}t.loadPosts();const a=t.getPost(v);if(!a){alert("Không tìm thấy bài viết"),m.push("/");return}if(a.authorId!==((i=r.user)==null?void 0:i.id)){alert("Bạn không có quyền chỉnh sửa bài viết này"),m.push("/");return}f.value=a,c.value=a.title,n.value=a.content,o.value=a.category,g.value=a.image}),{title:c,content:n,category:o,image:g,preview:y,post:f,categories:P,isLoading:p,onFileChange:a=>{var x;const i=(x=a.target.files)==null?void 0:x[0];if(!i)return;if(i.size>5*1024*1024){alert("Kích thước file không được vượt quá 5MB");return}const h=new FileReader;h.onload=()=>{g.value=h.result,y.value=h.result},h.readAsDataURL(i)},updatePost:async()=>{if(!c.value||!n.value||!o.value){alert("Vui lòng nhập đầy đủ thông tin");return}try{p.value=!0,t.updatePost(v,{title:c.value,content:n.value,category:o.value,image:g.value||f.value.image,authorId:r.user.id,authorName:r.user.name,authorAvatar:r.user.avatar}),alert("Cập nhật bài viết thành công!"),window.location.href=`/#/post/${v}`}catch(a){console.error("Error updating post:",a),alert("Có lỗi xảy ra. Vui lòng thử lại.")}finally{p.value=!1}}}}},I={class:"container mt-5",style:{"max-width":"600px"}},R={class:"card shadow-sm"},E={class:"card-body"},T={class:"mb-3"},K={class:"mb-3"},j={class:"mb-3"},z=["value"],G={class:"mb-3"},H={class:"d-flex align-items-center mb-2"},J=["src"],O={key:1,class:"rounded me-3"},Q=["src"],W=["disabled"],X={key:0,class:"spinner-border spinner-border-sm me-2"};function Y(m,e,r,t,v,c){var n;return u(),d("div",I,[s("div",R,[s("div",E,[e[11]||(e[11]=s("h3",{class:"mb-4 text-center"},"✍️ Chỉnh sửa bài viết",-1)),s("form",{onSubmit:e[4]||(e[4]=S((...o)=>t.updatePost&&t.updatePost(...o),["prevent"]))},[s("div",T,[e[5]||(e[5]=s("label",{class:"form-label"},"Tiêu đề",-1)),b(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=o=>t.title=o),required:""},null,512),[[_,t.title]])]),s("div",K,[e[6]||(e[6]=s("label",{class:"form-label"},"Nội dung",-1)),b(s("textarea",{class:"form-control","onUpdate:modelValue":e[1]||(e[1]=o=>t.content=o),rows:"5",required:""},null,512),[[_,t.content]])]),s("div",j,[e[8]||(e[8]=s("label",{class:"form-label"},"Danh mục",-1)),b(s("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=o=>t.category=o),required:""},[e[7]||(e[7]=s("option",{value:""},"Chọn danh mục",-1)),(u(!0),d(B,null,M(t.categories,o=>(u(),d("option",{key:o.value,value:o.value},C(o.label),9,z))),128))],512),[[q,t.category]])]),s("div",G,[e[9]||(e[9]=s("label",{class:"form-label"},"Ảnh bài viết",-1)),s("div",H,[t.preview?(u(),d("img",{key:0,src:t.preview,class:"rounded me-3",style:{"max-height":"200px"}},null,8,J)):(n=t.post)!=null&&n.image?(u(),d("div",O,[s("img",{src:t.post.image,class:"rounded",style:{"max-height":"200px"}},null,8,Q)])):w("",!0)]),s("input",{type:"file",class:"form-control",accept:"image/*",onChange:e[3]||(e[3]=(...o)=>t.onFileChange&&t.onFileChange(...o))},null,32),e[10]||(e[10]=s("small",{class:"text-muted"},"Upload ảnh mới (tối đa 2MB) hoặc giữ nguyên ảnh cũ",-1))]),s("button",{type:"submit",class:"btn btn-primary w-100",disabled:t.isLoading},[t.isLoading?(u(),d("span",X)):w("",!0),N(" "+C(t.isLoading?"Đang cập nhật...":"Cập nhật bài viết"),1)],8,W)],32)])])])}const oe=U(A,[["render",Y],["__scopeId","data-v-2631793d"]]);export{oe as default};
