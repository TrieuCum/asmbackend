import{x as U,u as V,r as h,y as x,o as C,a as l,s as o,b as s,q as M,i as g,f as v,v as p,p as f,t as n}from"./index-BahtY7yE.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={setup(){const u=U(),a=V(),d=h(!1),e=h(""),c=h(""),i=x({id:0,name:"",email:"",password:"",avatar:""}),t=x({name:"",email:"",password:"",avatar:""});C(()=>{const r=JSON.parse(localStorage.getItem("user")||"{}");if(!r.email){u.push("/login");return}Object.assign(i,r),c.value=r.avatar||""});const P=r=>{var w;const m=(w=r.target.files)==null?void 0:w[0];if(!m)return;if(m.size>2*1024*1024){t.avatar="Kích thước file không được vượt quá 2MB";return}if(!m.type.startsWith("image/")){t.avatar="Vui lòng chọn file ảnh";return}const b=new FileReader;b.onload=_=>{var y,k;c.value=(y=_.target)==null?void 0:y.result,i.avatar=(k=_.target)==null?void 0:k.result},b.readAsDataURL(m)},S=()=>{let r=!0;return t.name="",t.email="",t.password="",t.avatar="",i.name.length<2&&(t.name="Tên phải có ít nhất 2 ký tự",r=!1),/^[\w.-]+@[\w.-]+\.\w{2,}$/.test(i.email)||(t.email="Email không hợp lệ",r=!1),e.value&&e.value.length<6&&(t.password="Mật khẩu phải có ít nhất 6 ký tự",r=!1),r};return{user:i,newPassword:e,errors:t,loading:d,avatarPreview:c,handleFileUpload:P,updateProfile:async()=>{if(S())try{d.value=!0;const r={...i,password:e.value||i.password};localStorage.setItem("user",JSON.stringify(r)),a.updateUser(r),alert("Cập nhật thông tin thành công!"),u.push("/")}catch{t.email="Có lỗi xảy ra. Vui lòng thử lại."}finally{d.value=!1}}}}},B={class:"container mt-5"},F={class:"row justify-content-center"},q={class:"col-md-8"},D={class:"card shadow"},E={class:"card-body"},I={class:"text-center mb-4"},O=["src"],R={class:"mb-3"},z={key:0,class:"invalid-feedback"},A={class:"mb-3"},J={key:0,class:"invalid-feedback"},L={class:"mb-3"},T={key:0,class:"invalid-feedback"},K={class:"mb-3"},W={class:"d-flex align-items-center mb-2"},G=["src"],H={key:1,class:"rounded-circle me-3 bg-light d-flex align-items-center justify-content-center",style:{width:"64px",height:"64px"}},Q={key:0,class:"invalid-feedback"},X={class:"d-grid gap-2"},Y=["disabled"];function Z(u,a,d,e,c,i){return o(),l("div",B,[s("div",F,[s("div",q,[s("div",D,[s("div",E,[a[11]||(a[11]=s("h2",{class:"text-center mb-4"},"Profile Settings",-1)),s("div",I,[s("img",{src:e.user.avatar,alt:"Profile Picture",class:"rounded-circle",style:{width:"150px",height:"150px","object-fit":"cover"}},null,8,O)]),s("form",{onSubmit:a[4]||(a[4]=M((...t)=>e.updateProfile&&e.updateProfile(...t),["prevent"]))},[s("div",R,[a[5]||(a[5]=s("label",{class:"form-label"},"Name",-1)),g(s("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>e.user.name=t),class:f(["form-control",{"is-invalid":e.errors.name}]),required:""},null,2),[[p,e.user.name]]),e.errors.name?(o(),l("div",z,n(e.errors.name),1)):v("",!0)]),s("div",A,[a[6]||(a[6]=s("label",{class:"form-label"},"Email",-1)),g(s("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>e.user.email=t),type:"email",class:f(["form-control",{"is-invalid":e.errors.email}]),required:""},null,2),[[p,e.user.email]]),e.errors.email?(o(),l("div",J,n(e.errors.email),1)):v("",!0)]),s("div",L,[a[7]||(a[7]=s("label",{class:"form-label"},"New Password",-1)),g(s("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>e.newPassword=t),type:"password",class:f(["form-control",{"is-invalid":e.errors.password}]),placeholder:"Leave blank to keep current password"},null,2),[[p,e.newPassword]]),e.errors.password?(o(),l("div",T,n(e.errors.password),1)):v("",!0)]),s("div",K,[a[9]||(a[9]=s("label",{class:"form-label"},"Ảnh đại diện",-1)),s("div",W,[e.avatarPreview?(o(),l("img",{key:0,src:e.avatarPreview,class:"rounded-circle me-3",style:{width:"64px",height:"64px","object-fit":"cover"}},null,8,G)):(o(),l("div",H,a[8]||(a[8]=[s("i",{class:"bi bi-person"},null,-1)])))]),s("input",{type:"file",class:f(["form-control",{"is-invalid":e.errors.avatar}]),accept:"image/*",onChange:a[3]||(a[3]=(...t)=>e.handleFileUpload&&e.handleFileUpload(...t))},null,34),e.errors.avatar?(o(),l("div",Q,n(e.errors.avatar),1)):v("",!0),a[10]||(a[10]=s("small",{class:"text-muted"},"Upload ảnh đại diện (tối đa 2MB)",-1))]),s("div",X,[s("button",{class:"btn btn-primary",disabled:e.loading},n(e.loading?"Saving Changes...":"Save Changes"),9,Y)])],32)])])])])])}const se=N(j,[["render",Z],["__scopeId","data-v-a926a71b"]]);export{se as default};
