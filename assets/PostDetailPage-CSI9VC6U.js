import{d as L,u as H,C as T,r as y,c as x,o as $,a,b as t,t as o,f as w,h as c,p as q,m as f,w as g,n as E,g as z,q as F,i as R,v as G,F as k,l as C,x as K,s as r}from"./index-BahtY7yE.js";import{u as U}from"./Post-Baz_lnpz.js";const X={class:"container mt-4"},J={key:0,class:"row"},O={class:"col-lg-8"},Q={class:"card shadow-sm mb-4"},W=["src","alt"],Y={class:"card-body"},Z={class:"d-flex justify-content-between align-items-start mb-3"},tt={class:"badge bg-primary"},st={class:"text-muted"},et={class:"card-title"},nt={class:"d-flex align-items-center mb-3"},it=["src"],ot={class:"fw-bold"},lt={class:"text-muted"},at={class:"card-text",style:{"line-height":"1.8","font-size":"1.1rem"}},rt={class:"card-footer bg-transparent"},dt={class:"d-flex justify-content-between align-items-center"},ct={class:"d-flex gap-3"},ut={class:"d-flex align-items-center"},mt={key:0,class:"d-flex gap-2"},ht={class:"card shadow-sm"},vt={class:"card-header"},bt={class:"mb-0"},_t={class:"card-body"},ft={key:0,class:"mb-4"},gt={class:"mb-3"},pt={key:1,class:"text-center py-3"},xt={class:"text-muted"},yt={key:2},wt={class:"d-flex"},kt=["src"],Ct={class:"flex-grow-1"},Vt={class:"d-flex justify-content-between align-items-start"},Dt={class:"fw-bold"},At={class:"text-muted"},Pt=["onClick"],Bt={class:"mt-2 mb-0"},It={key:3,class:"text-center py-4"},Mt={class:"col-lg-4"},jt={class:"card shadow-sm"},Nt={class:"card-body"},St=["src"],Lt={class:"flex-grow-1"},Ht={class:"mb-1"},Tt={class:"text-muted"},$t={key:1,class:"text-center py-5"},Rt=L({__name:"PostDetailPage",setup(qt){const V=T(),D=K(),i=H(),d=U(),u=parseInt(V.params.id),e=y(null),v=y(""),A=x(()=>{var l;return!i.user||!((l=e.value)!=null&&l.likes)?!1:e.value.likes.includes(i.user.id)}),P=x(()=>!i.user||!e.value?!1:i.user.id===e.value.authorId||i.user.role==="admin"),B=x(()=>e.value?d.posts.filter(l=>l.id!==u&&l.category===e.value.category).slice(0,3):[]),p=l=>{const s=new Date(l),_=Math.floor((new Date().getTime()-s.getTime())/1e3);if(_<60)return"Vừa xong";const m=Math.floor(_/60);if(m<60)return`${m} phút trước`;const h=Math.floor(m/60);if(h<24)return`${h} giờ trước`;const n=Math.floor(h/24);return n<7?`${n} ngày trước`:s.toLocaleDateString("vi-VN")},I=()=>{if(!i.isAuthenticated){alert("Vui lòng đăng nhập để thích bài viết");return}d.toggleLike(u,i.user.id),e.value=d.getPost(u)},M=()=>{if(!i.isAuthenticated||!i.user){alert("Vui lòng đăng nhập để bình luận");return}if(!v.value.trim())return;d.addComment(u,v.value.trim(),i.user.id,i.user.name,i.user.avatar)&&(v.value="",e.value=d.getPost(u))},j=l=>{confirm("Bạn có chắc chắn muốn xóa bình luận này?")&&(d.deleteComment(u,l),e.value=d.getPost(u))},N=l=>i.user?i.user.id===l.authorId||i.user.role==="admin":!1,S=()=>{confirm("Bạn có chắc chắn muốn xóa bài viết này?")&&(d.deletePost(u),alert("Đã xóa bài viết thành công!"),D.push({name:"Home"}))};return $(()=>{d.loadPosts(),e.value=d.getPost(u),e.value&&d.incrementViews(u)}),(l,s)=>{var _,m,h;const b=E("router-link");return r(),a("div",X,[e.value?(r(),a("div",J,[t("div",O,[t("div",Q,[t("img",{src:e.value.image,class:"card-img-top",style:{height:"400px","object-fit":"cover"},alt:e.value.title},null,8,W),t("div",Y,[t("div",Z,[t("span",tt,o(e.value.category),1),t("small",st,o(p(e.value.createdAt)),1)]),t("h1",et,o(e.value.title),1),t("div",nt,[t("img",{src:e.value.authorAvatar,class:"rounded-circle me-2",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,it),t("div",null,[t("div",ot,o(e.value.authorName),1),t("small",lt,o(e.value.views||0)+" lượt xem",1)])]),t("div",at,o(e.value.content),1)]),t("div",rt,[t("div",dt,[t("div",ct,[t("button",{onClick:I,class:"btn btn-outline-danger"},[t("i",{class:q(["bi",A.value?"bi-heart-fill":"bi-heart"])},null,2),c(" "+o(((_=e.value.likes)==null?void 0:_.length)||0)+" lượt thích ",1)]),t("span",ut,[s[1]||(s[1]=t("i",{class:"bi bi-chat me-1"},null,-1)),c(" "+o(((m=e.value.comments)==null?void 0:m.length)||0)+" bình luận ",1)])]),P.value?(r(),a("div",mt,[f(b,{to:{name:"EditPost",params:{id:e.value.id}},class:"btn btn-outline-primary btn-sm"},{default:g(()=>s[2]||(s[2]=[t("i",{class:"bi bi-pencil me-1"},null,-1),c("Chỉnh sửa ")])),_:1,__:[2]},8,["to"]),t("button",{onClick:S,class:"btn btn-outline-danger btn-sm"},s[3]||(s[3]=[t("i",{class:"bi bi-trash me-1"},null,-1),c("Xóa ")]))])):w("",!0)])])]),t("div",ht,[t("div",vt,[t("h5",bt,[s[4]||(s[4]=t("i",{class:"bi bi-chat-dots me-2"},null,-1)),c(" Bình luận ("+o(((h=e.value.comments)==null?void 0:h.length)||0)+") ",1)])]),t("div",_t,[z(i).isAuthenticated?(r(),a("div",ft,[t("form",{onSubmit:F(M,["prevent"])},[t("div",gt,[R(t("textarea",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=n=>v.value=n),rows:"3",placeholder:"Viết bình luận của bạn...",required:""},null,512),[[G,v.value]])]),s[5]||(s[5]=t("button",{type:"submit",class:"btn btn-primary"},[t("i",{class:"bi bi-send me-1"}),c("Gửi bình luận ")],-1))],32)])):(r(),a("div",pt,[t("p",xt,[s[7]||(s[7]=c("Vui lòng ")),f(b,{to:{name:"Login"}},{default:g(()=>s[6]||(s[6]=[c("đăng nhập")])),_:1,__:[6]}),s[8]||(s[8]=c(" để bình luận"))])])),e.value.comments&&e.value.comments.length>0?(r(),a("div",yt,[(r(!0),a(k,null,C(e.value.comments,n=>(r(),a("div",{key:n.id,class:"border-bottom pb-3 mb-3"},[t("div",wt,[t("img",{src:n.authorAvatar||"https://via.placeholder.com/32",class:"rounded-circle me-3",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,kt),t("div",Ct,[t("div",Vt,[t("div",null,[t("div",Dt,o(n.authorName),1),t("small",At,o(p(n.createdAt)),1)]),N(n)?(r(),a("button",{key:0,onClick:Et=>j(n.id),class:"btn btn-sm btn-outline-danger"},s[9]||(s[9]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Pt)):w("",!0)]),t("p",Bt,o(n.content),1)])])]))),128))])):(r(),a("div",It,s[10]||(s[10]=[t("i",{class:"bi bi-chat display-4 text-muted"},null,-1),t("p",{class:"text-muted mt-2"},"Chưa có bình luận nào. Hãy là người đầu tiên bình luận!",-1)])))])])]),t("div",Mt,[t("div",jt,[s[11]||(s[11]=t("div",{class:"card-header"},[t("h6",{class:"mb-0"},"Bài viết liên quan")],-1)),t("div",Nt,[(r(!0),a(k,null,C(B.value,n=>(r(),a("div",{key:n.id,class:"d-flex mb-3"},[t("img",{src:n.image,class:"rounded me-3",style:{width:"60px",height:"60px","object-fit":"cover"}},null,8,St),t("div",Lt,[t("h6",Ht,[f(b,{to:{name:"PostDetail",params:{id:n.id}},class:"text-decoration-none"},{default:g(()=>[c(o(n.title.substring(0,50))+"... ",1)]),_:2},1032,["to"])]),t("small",Tt,o(p(n.createdAt)),1)])]))),128))])])])])):(r(),a("div",$t,[s[13]||(s[13]=t("i",{class:"bi bi-exclamation-triangle display-1 text-muted"},null,-1)),s[14]||(s[14]=t("h3",{class:"mt-3"},"Không tìm thấy bài viết",-1)),s[15]||(s[15]=t("p",{class:"text-muted"},"Bài viết này có thể đã bị xóa hoặc không tồn tại.",-1)),f(b,{to:{name:"Home"},class:"btn btn-primary"},{default:g(()=>s[12]||(s[12]=[t("i",{class:"bi bi-house me-1"},null,-1),c("Về trang chủ ")])),_:1,__:[12]})]))])}}});export{Rt as default};
